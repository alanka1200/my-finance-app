<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finance Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background: #f5f7fa;
            color: #333;
            max-width: 100%;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .header .date {
            opacity: 0.9;
            font-size: 14px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9ff;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #eef0f3;
        }

        /* –ë–∞–ª–∞–Ω—Å */
        .balance-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .balance-change {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .balance-change.positive {
            color: #4caf50;
        }

        .balance-change.negative {
            color: #f44336;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid #eef0f3;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-container {
            margin: 20px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π */
        .transaction-list {
            margin-top: 20px;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
        }

        .transaction-icon.income {
            background: #e8f5e9;
            color: #4caf50;
        }

        .transaction-icon.expense {
            background: #ffebee;
            color: #f44336;
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-category {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .transaction-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }

        .transaction-date {
            font-size: 11px;
            color: #999;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 18px;
        }

        .transaction-amount.positive {
            color: #4caf50;
        }

        .transaction-amount.negative {
            color: #f44336;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            text-decoration: none;
            width: 100%;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-secondary {
            background: #757575;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ */
        .investment-card {
            border-left: 4px solid #ff9800;
        }

        .investment-profit {
            font-size: 14px;
            color: #4caf50;
            font-weight: 600;
        }

        /* –°–æ–≤–µ—Ç—ã */
        .advice-list {
            margin-top: 20px;
        }

        .advice-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: #fff8e1;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #ffc107;
        }

        .advice-icon {
            font-size: 20px;
            margin-right: 15px;
            margin-top: 2px;
        }

        .advice-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.5;
        }

        /* –î–∏–∞–≥—Ä–∞–º–º–∞ */
        .chart-container {
            height: 200px;
            margin: 20px 0;
            position: relative;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s, slideOut 0.3s 2.7s;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 12px 5px;
            }
            
            .balance-amount {
                font-size: 28px;
            }
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 18px;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e0e0e0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        /* –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ */
        .referral-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .referral-link {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            word-break: break-all;
            border: 2px dashed #667eea;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }

        /* –ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>Finance Tracker</h1>
            <div class="date" id="currentDate">–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 19 —è–Ω–≤–∞—Ä—è 2026 –≥.</div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('dashboard')">üìä –î–∞—à–±–æ—Ä–¥</div>
            <div class="nav-tab" onclick="switchTab('transactions')">üí∏ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</div>
            <div class="nav-tab" onclick="switchTab('goals')">üéØ –¶–µ–ª–∏</div>
            <div class="nav-tab" onclick="switchTab('investments')">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
            <div class="nav-tab" onclick="switchTab('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div id="dashboard" class="tab-content active">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>

        <div id="transactions" class="tab-content">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>

        <div id="goals" class="tab-content">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>

        <div id="investments" class="tab-content">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>

        <div id="profile" class="tab-content">
            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</div>
                <button class="modal-close" onclick="closeModal('transactionModal')">√ó</button>
            </div>
            <form id="transactionForm">
                <input type="hidden" id="user_id">
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                    <select class="form-select" id="transactionType" required>
                        <option value="income">‚ûï –î–æ—Ö–æ–¥</option>
                        <option value="expense">‚ûñ –†–∞—Å—Ö–æ–¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="transactionCategory" required>
                        <option value="–∑–∞—Ä–ø–ª–∞—Ç–∞">üíº –ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                        <option value="–µ–¥–∞">üçé –ï–¥–∞</option>
                        <option value="—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                        <option value="–∂–∏–ª—å–µ">üè† –ñ–∏–ª—å–µ</option>
                        <option value="—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                        <option value="–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                        <option value="–∑–¥–æ—Ä–æ–≤—å–µ">üè• –ó–¥–æ—Ä–æ–≤—å–µ</option>
                        <option value="–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
                        <option value="–¥—Ä—É–≥–æ–µ">üì¶ –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" class="form-input" id="transactionAmount" 
                           placeholder="0.00" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="transactionDescription" 
                           placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏" maxlength="100">
                </div>
                <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ü–µ–ª–∏ -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ù–æ–≤–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å</div>
                <button class="modal-close" onclick="closeModal('goalModal')">√ó</button>
            </div>
            <form id="goalForm">
                <input type="hidden" id="goalUserId">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                    <input type="text" class="form-input" id="goalName" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="goalCategory" required>
                        <option value="—Ç–µ—Ö–Ω–∏–∫–∞">üíª –¢–µ—Ö–Ω–∏–∫–∞</option>
                        <option value="–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</option>
                        <option value="–∞–≤—Ç–æ–º–æ–±–∏–ª—å">üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                        <option value="–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                        <option value="–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                        <option value="–¥—Ä—É–≥–æ–µ">üì¶ –î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ (‚ÇΩ)</label>
                        <input type="number" class="form-input" id="goalCurrent" 
                               placeholder="0" min="0" step="1000" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¶–µ–ª–µ–≤–∞—è —Å—É–º–º–∞ (‚ÇΩ)</label>
                        <input type="number" class="form-input" id="goalTarget" 
                               placeholder="100000" min="1" step="1000" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–î–µ–¥–ª–∞–π–Ω</label>
                    <input type="date" class="form-input" id="goalDeadline" required>
                </div>
                <button type="submit" class="btn btn-success">üéØ –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ -->
    <div id="investmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é</div>
                <button class="modal-close" onclick="closeModal('investmentModal')">√ó</button>
            </div>
            <form id="investmentForm">
                <input type="hidden" id="investmentUserId">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="investmentName" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–£–ö–û–ô–õ" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø</label>
                    <select class="form-select" id="investmentType" required>
                        <option value="–ê–∫—Ü–∏–∏">üìä –ê–∫—Ü–∏–∏</option>
                        <option value="–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞">‚Çø –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                        <option value="–û–±–ª–∏–≥–∞—Ü–∏–∏">üìÑ –û–±–ª–∏–≥–∞—Ü–∏–∏</option>
                        <option value="–î–µ–ø–æ–∑–∏—Ç">üè¶ –î–µ–ø–æ–∑–∏—Ç</option>
                        <option value="–§–æ–Ω–¥—ã">üìà –§–æ–Ω–¥—ã</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="text" class="form-input" id="investmentCount" 
                               placeholder="10 —à—Ç.">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                        <input type="number" class="form-input" id="investmentAmount" 
                               placeholder="50000" min="0" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" class="form-input" id="investmentInvested" 
                           placeholder="45000" min="0" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</label>
                    <input type="date" class="form-input" id="investmentBuyDate" required>
                </div>
                <button type="submit" class="btn btn-success">üíé –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é</button>
            </form>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification" class="notification" style="display: none;"></div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let currentTab = 'dashboard';
        const API_URL = 'https://alanka1200.github.io';  // –¢–æ—Ç –∂–µ –¥–æ–º–µ–Ω
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            updateCurrentDate();
            
            // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id') || urlParams.get('user') || '123456';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await loadUserData(userId);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ä–º—ã
            initForms();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—à–±–æ—Ä–¥
            renderDashboard();
            
            // –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
        });

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            document.querySelector(`.nav-tab[onclick*="${tabName}"]`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏
            currentTab = tabName;
            
            switch(tabName) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'transactions':
                    renderTransactions();
                    break;
                case 'goals':
                    renderGoals();
                    break;
                case 'investments':
                    renderInvestments();
                    break;
                case 'profile':
                    renderProfile();
                    break;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = now.toLocaleDateString('ru-RU', options);
            document.getElementById('currentDate').textContent = dateStr;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData(userId) {
            try {
                showLoading();
                
                const response = await fetch(`${API_URL}/api/user_data?user_id=${userId}`);
                const data = await response.json();
                
                if (data.error) {
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    currentUser = createTestUser(userId);
                    showNotification('–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', 'info');
                } else {
                    currentUser = data;
                }
                
                hideLoading();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                currentUser = createTestUser(userId);
                showNotification('–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ', 'warning');
                hideLoading();
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function createTestUser(userId) {
            return {
                user_id: userId,
                first_name: '–ò–≤–∞–Ω',
                username: 'ivan_dmitrienko',
                join_date: '2024-01-15',
                balance: 25000,
                monthly_income: 120000,
                monthly_expenses: 95000,
                savings_percent: 20.8,
                investments_total: 25000,
                financial_health: 75,
                main_goal: '–ù–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É',
                savings_goal: 50000,
                investment_percent: 15,
                transactions: [
                    {
                        id: 1,
                        type: 'income',
                        category: '–∑–∞—Ä–ø–ª–∞—Ç–∞',
                        amount: 120000,
                        description: '–ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å',
                        date: '31.01.2024, 10:00'
                    },
                    {
                        id: 2,
                        type: 'expense',
                        category: '–µ–¥–∞',
                        amount: 25000,
                        description: '–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –Ω–µ–¥–µ–ª—é',
                        date: '01.02.2024, 18:30'
                    },
                    {
                        id: 3,
                        type: 'expense',
                        category: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                        amount: 5000,
                        description: '–ë–µ–Ω–∑–∏–Ω',
                        date: '02.02.2024, 14:15'
                    }
                ],
                goals: [
                    {
                        id: 1,
                        name: '–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫',
                        category: '—Ç–µ—Ö–Ω–∏–∫–∞',
                        current: 25000,
                        target: 100000,
                        progress: 25.0,
                        days_left: 90,
                        deadline: '2024-06-30',
                        daily: 833.33,
                        created: '2024-01-15'
                    },
                    {
                        id: 2,
                        name: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –¢—É—Ä—Ü–∏—é',
                        category: '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
                        current: 33333,
                        target: 100000,
                        progress: 33.3,
                        days_left: 135,
                        deadline: '2024-08-15',
                        daily: 740.74,
                        created: '2024-01-20'
                    }
                ],
                investments: [
                    {
                        id: 1,
                        name: '–õ–£–ö–û–ô–õ',
                        type: '–ê–∫—Ü–∏–∏',
                        amount: 55000,
                        count: '10 —à—Ç.',
                        invested: 50000,
                        profit: 5000,
                        profit_percent: 10.0,
                        buy_date: '2024-01-15'
                    },
                    {
                        id: 2,
                        name: 'Bitcoin',
                        type: '–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞',
                        amount: 25000,
                        count: '0.0005 —à—Ç.',
                        invested: 20000,
                        profit: 5000,
                        profit_percent: 25.0,
                        buy_date: '2024-02-01'
                    },
                    {
                        id: 3,
                        name: '–°–±–µ—Ä–±–∞–Ω–∫',
                        type: '–ê–∫—Ü–∏–∏',
                        amount: 32000,
                        count: '15 —à—Ç.',
                        invested: 30000,
                        profit: 2000,
                        profit_percent: 6.7,
                        buy_date: '2024-01-20'
                    }
                ]
            };
        }

        // –†–µ–Ω–¥–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞
        function renderDashboard() {
            if (!currentUser) return;
            
            const container = document.getElementById('dashboard');
            
            const html = `
                <!-- –ë–∞–ª–∞–Ω—Å -->
                <div class="balance-card">
                    <div style="font-size: 14px; opacity: 0.9;">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                    <div class="balance-amount">${formatCurrency(currentUser.balance)}</div>
                    <div class="balance-change positive">
                        <span>+${formatCurrency(currentUser.balance)} –∑–∞ –º–µ—Å—è—Ü</span>
                    </div>
                    <div style="font-size: 12px; margin-top: 10px; opacity: 0.8;">
                        –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                    </div>
                </div>

                <!-- –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ -->
                <div class="card">
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>${currentUser.financial_health} / 100</span>
                            <span>–§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${currentUser.financial_health}%"></div>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: #666; font-size: 14px;">
                            ${getFinancialHealthStatus(currentUser.financial_health)}
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">–î–æ—Ö–æ–¥—ã</div>
                        <div class="stat-value">${formatCurrency(currentUser.monthly_income)}</div>
                        <div style="font-size: 12px; color: #4caf50;">12 –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã</div>
                        <div class="stat-value">${formatCurrency(currentUser.monthly_expenses)}</div>
                        <div style="font-size: 12px; color: #f44336;">19 –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–°–±–µ—Ä–µ–∂–µ–Ω–∏—è</div>
                        <div class="stat-value">${currentUser.savings_percent}%</div>
                        <div style="font-size: 12px; color: #2196f3;">–æ—Ç –¥–æ—Ö–æ–¥–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
                        <div class="stat-value">${formatCurrency(currentUser.investments_total)}</div>
                        <div style="font-size: 12px; color: #ff9800;">3 –∞–∫—Ç–∏–≤–∞</div>
                    </div>
                </div>

                <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="font-size: 18px;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                        <span style="color: #667eea; font-size: 14px; cursor: pointer;">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</span>
                    </div>
                    <div class="chart-container" id="expenseChart"></div>
                    <div class="chart-legend" id="expenseLegend"></div>
                </div>

                <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="font-size: 18px;">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã</h3>
                        <span style="color: #667eea; font-size: 14px; cursor: pointer;">–ï—â–µ ‚Üí</span>
                    </div>
                    <div class="advice-list">
                        <div class="advice-item">
                            <div class="advice-icon">üü†</div>
                            <div class="advice-text">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–∞ 20%</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-icon">üî¥</div>
                            <div class="advice-text">–û—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ 20% –æ—Ç –¥–æ—Ö–æ–¥–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-icon">‚úÖ</div>
                            <div class="advice-text">–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∞–∫—Ü–∏–∏ –õ–£–ö–û–ô–õ</div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // –†–∏—Å—É–µ–º –¥–∏–∞–≥—Ä–∞–º–º—É —Ä–∞—Å—Ö–æ–¥–æ–≤
            renderExpenseChart();
        }

        // –†–µ–Ω–¥–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        function renderTransactions() {
            if (!currentUser) return;
            
            const container = document.getElementById('transactions');
            
            // –§–∏–ª—å—Ç—Ä—ã
            const filterHtml = `
                <div class="filters">
                    <button class="filter-btn active" onclick="filterTransactions('all')">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterTransactions('income')">–î–æ—Ö–æ–¥—ã</button>
                    <button class="filter-btn" onclick="filterTransactions('expense')">–†–∞—Å—Ö–æ–¥—ã</button>
                    <select class="form-select" style="flex: 1;" onchange="filterByCategory(this.value)">
                        <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="–∑–∞—Ä–ø–ª–∞—Ç–∞">–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                        <option value="–µ–¥–∞">–ï–¥–∞</option>
                        <option value="—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                        <option value="–∂–∏–ª—å–µ">–ñ–∏–ª—å–µ</option>
                        <option value="—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                    </select>
                </div>
            `;
            
            // –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            let transactionsHtml = '';
            
            if (currentUser.transactions && currentUser.transactions.length > 0) {
                currentUser.transactions.forEach(transaction => {
                    const isIncome = transaction.type === 'income';
                    const icon = isIncome ? '‚ûï' : '‚ûñ';
                    const amountClass = isIncome ? 'positive' : 'negative';
                    
                    transactionsHtml += `
                        <div class="transaction-item" data-id="${transaction.id}">
                            <div class="transaction-icon ${transaction.type}">${icon}</div>
                            <div class="transaction-details">
                                <div class="transaction-category">${transaction.category}</div>
                                <div class="transaction-description">${transaction.description}</div>
                                <div class="transaction-date">${transaction.date}</div>
                            </div>
                            <div class="transaction-amount ${amountClass}">
                                ${isIncome ? '+' : '-'}${formatCurrency(transaction.amount)}
                            </div>
                        </div>
                    `;
                });
            } else {
                transactionsHtml = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí∏</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                        <div style="color: #999; margin-bottom: 20px;">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</div>
                        <button class="btn btn-small" onclick="openModal('transactionModal')">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = `
                ${filterHtml}
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 18px;">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                    <button class="btn btn-small" onclick="openModal('transactionModal')">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
                
                <div class="transaction-list">
                    ${transactionsHtml}
                </div>
                
                <div style="text-align: center; margin-top: 30px; color: #999; font-size: 14px;">
                    –í—Å–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π: ${currentUser.transactions ? currentUser.transactions.length : 0}
                </div>
            `;
        }

        // –†–µ–Ω–¥–µ—Ä —Ü–µ–ª–µ–π
        function renderGoals() {
            if (!currentUser) return;
            
            const container = document.getElementById('goals');
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏
            let activeGoalsHtml = '';
            let achievedGoalsHtml = '';
            
            if (currentUser.goals && currentUser.goals.length > 0) {
                currentUser.goals.forEach(goal => {
                    const isAchieved = goal.progress >= 100;
                    
                    const goalHtml = `
                        <div class="card" style="border-left: 4px solid ${getGoalColor(goal.category)};">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                                <div>
                                    <h4 style="font-size: 16px; margin-bottom: 5px;">${goal.name}</h4>
                                    <div style="font-size: 14px; color: #666;">${getCategoryIcon(goal.category)} ${goal.category}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 24px; font-weight: 700; color: #333;">${goal.progress}%</div>
                                </div>
                            </div>
                            
                            <div class="progress-bar" style="margin: 15px 0;">
                                <div class="progress-fill" style="width: ${Math.min(goal.progress, 100)}%; background: ${getGoalColor(goal.category)};"></div>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                                <div>${formatCurrency(goal.current)} / ${formatCurrency(goal.target)}</div>
                                <div>${goal.days_left} –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å</div>
                            </div>
                            
                            ${!isAchieved ? `
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                                <div style="font-size: 14px; color: #666;">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ: ${formatCurrency(goal.daily)}</div>
                                <div style="font-size: 12px; color: #999;">–°—Ä–æ–∫: ${formatDate(goal.deadline)}</div>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    if (isAchieved) {
                        achievedGoalsHtml += goalHtml;
                    } else {
                        activeGoalsHtml += goalHtml;
                    }
                });
            }
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <button class="btn" onclick="openModal('goalModal')">
                        üéØ + –ù–æ–≤–∞—è —Ü–µ–ª—å
                    </button>
                </div>
                
                ${activeGoalsHtml ? `
                    <h3 style="font-size: 18px; margin-bottom: 15px;">–ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏</h3>
                    ${activeGoalsHtml}
                ` : ''}
                
                ${achievedGoalsHtml ? `
                    <h3 style="font-size: 18px; margin: 25px 0 15px;">–î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏</h3>
                    ${achievedGoalsHtml}
                ` : ''}
                
                ${!activeGoalsHtml && !achievedGoalsHtml ? `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéØ</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">–ù–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</div>
                        <div style="color: #999; margin-bottom: 20px;">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Ü–µ–ª—å</div>
                        <button class="btn" onclick="openModal('goalModal')">
                            üéØ –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å
                        </button>
                    </div>
                ` : ''}
            `;
        }

        // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
        function renderInvestments() {
            if (!currentUser) return;
            
            const container = document.getElementById('investments');
            
            // –ü–æ—Ä—Ç—Ñ–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
            let investmentsHtml = '';
            let totalValue = 0;
            let totalInvested = 0;
            
            if (currentUser.investments && currentUser.investments.length > 0) {
                currentUser.investments.forEach(investment => {
                    totalValue += investment.amount;
                    totalInvested += investment.invested;
                    
                    const profitClass = investment.profit >= 0 ? 'positive' : 'negative';
                    const profitSign = investment.profit >= 0 ? '+' : '';
                    
                    investmentsHtml += `
                        <div class="card investment-card">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                <div>
                                    <h4 style="font-size: 16px; margin-bottom: 5px;">${investment.name}</h4>
                                    <div style="font-size: 14px; color: #666;">${investment.type}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 20px; font-weight: 700; color: #333;">${formatCurrency(investment.amount)}</div>
                                </div>
                            </div>
                            
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">
                                ${investment.count}
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px;">
                                <div>–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${formatCurrency(investment.invested)}</div>
                                <div class="investment-profit ${profitClass}">
                                    ${profitSign}${formatCurrency(investment.profit)} (${profitSign}${investment.profit_percent}%)
                                </div>
                            </div>
                            
                            <div style="font-size: 12px; color: #999; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px;">
                                –ö—É–ø–ª–µ–Ω–æ: ${formatDate(investment.buy_date)}
                            </div>
                        </div>
                    `;
                });
            }
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalProfit = totalValue - totalInvested;
            const totalProfitPercent = totalInvested > 0 ? (totalProfit / totalInvested * 100).toFixed(1) : 0;
            const profitClass = totalProfit >= 0 ? 'positive' : 'negative';
            const profitSign = totalProfit >= 0 ? '+' : '';
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <button class="btn" onclick="openModal('investmentModal')">
                        üìà + –ù–æ–≤–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è
                    </button>
                </div>
                
                <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="card">
                    <h3 style="font-size: 18px; margin-bottom: 15px;">–ü–æ—Ä—Ç—Ñ–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</h3>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <div style="font-size: 14px; color: #666;">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                            <div style="font-size: 28px; font-weight: 700; color: #333;">${formatCurrency(totalValue)}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 14px; color: #666;">–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                            <div style="font-size: 20px; font-weight: 700;" class="${profitClass}">
                                ${profitSign}${formatCurrency(totalProfit)} (${profitSign}${totalProfitPercent}%)
                            </div>
                        </div>
                    </div>
                    
                    <div style="font-size: 14px; color: #666; text-align: center; padding-top: 15px; border-top: 1px solid #eee;">
                        ${currentUser.investments ? currentUser.investments.length : 0} –∞–∫—Ç–∏–≤–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π -->
                ${investmentsHtml ? `
                    <h3 style="font-size: 18px; margin: 25px 0 15px;">–í–∞—à–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h3>
                    ${investmentsHtml}
                ` : `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìà</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">–ù–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
                        <div style="color: #999; margin-bottom: 20px;">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é</div>
                    </div>
                `}
            `;
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è
        function renderProfile() {
            if (!currentUser) return;
            
            const container = document.getElementById('profile');
            
            container.innerHTML = `
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                <div class="card">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); 
                                border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; 
                                font-size: 32px; color: white; margin-bottom: 15px;">
                            ${currentUser.first_name ? currentUser.first_name[0].toUpperCase() : 'U'}
                        </div>
                        <h3 style="font-size: 20px; margin-bottom: 5px;">${currentUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</h3>
                        <div style="color: #666; font-size: 14px;">IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin: 20px 0; padding: 15px; background: #f8f9ff; border-radius: 10px;">
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #666;">–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Ö–æ–¥</div>
                            <div style="font-size: 18px; font-weight: 700; color: #333;">${formatCurrency(currentUser.monthly_income)}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #666;">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                            <div style="font-size: 18px; font-weight: 700; color: #333;">${formatCurrency(currentUser.balance)}</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ì–ª–∞–≤–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å -->
                <div class="card">
                    <h3 style="font-size: 18px; margin-bottom: 15px;">–ì–ª–∞–≤–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å</h3>
                    <div style="padding: 15px; background: #e8f5e9; border-radius: 10px; border-left: 4px solid #4caf50;">
                        <div style="font-size: 16px; font-weight: 500; color: #333;">üè† ${currentUser.main_goal}</div>
                    </div>
                </div>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π -->
                <div class="card">
                    <h3 style="font-size: 18px; margin-bottom: 15px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">–¶–µ–ª—å –ø–æ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è–º:</div>
                        <div style="font-size: 18px; font-weight: 700; color: #333;">${formatCurrency(currentUser.savings_goal)}/–º–µ—Å</div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">–î–æ–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π:</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${currentUser.investment_percent}%; background: #ff9800;"></div>
                        </div>
                        <div style="text-align: right; margin-top: 5px; font-size: 16px; font-weight: 700; color: #333;">
                            ${currentUser.investment_percent}%
                        </div>
                    </div>
                </div>
                
                <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
                <div class="referral-card">
                    <h3 style="font-size: 18px; margin-bottom: 10px;">üéÅ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞</h3>
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                        –ü–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 10% –∑–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞!
                    </p>
                    
                    <div class="referral-link" id="referralLink">
                        –ó–∞–≥—Ä—É–∑–∫–∞...
                    </div>
                    
                    <button class="copy-btn" onclick="copyReferralLink()">
                        üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    </button>
                </div>
                
                <!-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö -->
                <div class="card">
                    <h3 style="font-size: 18px; margin-bottom: 15px;">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn btn-small" style="flex: 1;" onclick="exportData('csv')">
                            üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                        </button>
                        <button class="btn btn-small" style="flex: 1;" onclick="exportData('json')">
                            üìÅ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
                        </button>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="createReport()">
                        üìÑ –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                    </button>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ -->
                <div style="text-align: center; color: #999; font-size: 14px; margin-top: 30px; padding: 20px;">
                    <div>üìÖ –£—á–∞—Å—Ç–Ω–∏–∫ —Å ${formatDate(currentUser.join_date)}</div>
                    <div style="margin-top: 10px;">@FinancialLead_bot</div>
                </div>
            `;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
            loadReferralLink();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º
        function initForms() {
            // –§–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            document.getElementById('transactionForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    user_id: currentUser.user_id,
                    type: document.getElementById('transactionType').value,
                    category: document.getElementById('transactionCategory').value,
                    amount: parseFloat(document.getElementById('transactionAmount').value),
                    description: document.getElementById('transactionDescription').value,
                    date: new Date().toLocaleString('ru-RU', { 
                        day: '2-digit', 
                        month: '2-digit', 
                        year: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })
                };
                
                try {
                    const response = await fetch(`${API_URL}/api/update_transaction`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        await loadUserData(currentUser.user_id);
                        
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                        closeModal('transactionModal');
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        showNotification('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–∫–ª–∞–¥–∫—É
                        if (currentTab === 'transactions') {
                            renderTransactions();
                        } else if (currentTab === 'dashboard') {
                            renderDashboard();
                        }
                    }
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏', 'error');
                    console.error(error);
                }
            });
            
            // –§–æ—Ä–º–∞ —Ü–µ–ª–∏
            document.getElementById('goalForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    user_id: currentUser.user_id,
                    name: document.getElementById('goalName').value,
                    category: document.getElementById('goalCategory').value,
                    current: parseFloat(document.getElementById('goalCurrent').value),
                    target: parseFloat(document.getElementById('goalTarget').value),
                    deadline: document.getElementById('goalDeadline').value
                };
                
                try {
                    const response = await fetch(`${API_URL}/api/update_goal`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        await loadUserData(currentUser.user_id);
                        closeModal('goalModal');
                        showNotification('–¶–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                        
                        if (currentTab === 'goals') {
                            renderGoals();
                        }
                    }
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ü–µ–ª–∏', 'error');
                    console.error(error);
                }
            });
            
            // –§–æ—Ä–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
            document.getElementById('investmentForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    user_id: currentUser.user_id,
                    name: document.getElementById('investmentName').value,
                    type: document.getElementById('investmentType').value,
                    amount: parseFloat(document.getElementById('investmentAmount').value),
                    count: document.getElementById('investmentCount').value,
                    invested: parseFloat(document.getElementById('investmentInvested').value),
                    buy_date: document.getElementById('investmentBuyDate').value
                };
                
                try {
                    const response = await fetch(`${API_URL}/api/update_investment`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        await loadUserData(currentUser.user_id);
                        closeModal('investmentModal');
                        showNotification('–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                        
                        if (currentTab === 'investments') {
                            renderInvestments();
                        }
                    }
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', 'error');
                    console.error(error);
                }
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∞—Ç
            document.getElementById('goalDeadline').valueAsDate = new Date(new Date().setMonth(new Date().getMonth() + 6));
            document.getElementById('investmentBuyDate').valueAsDate = new Date();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount) + ' ‚ÇΩ';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('ru-RU');
        }

        function getFinancialHealthStatus(score) {
            if (score >= 80) return '–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ üéØ';
            if (score >= 60) return '–•–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ üëç';
            if (score >= 40) return '–°—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚ö†Ô∏è';
            return '–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è ‚ùó';
        }

        function getGoalColor(category) {
            const colors = {
                '—Ç–µ—Ö–Ω–∏–∫–∞': '#2196f3',
                '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ': '#ff9800',
                '–∞–≤—Ç–æ–º–æ–±–∏–ª—å': '#f44336',
                '–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å': '#4caf50',
                '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': '#9c27b0',
                '–¥—Ä—É–≥–æ–µ': '#795548'
            };
            return colors[category] || '#667eea';
        }

        function getCategoryIcon(category) {
            const icons = {
                '—Ç–µ—Ö–Ω–∏–∫–∞': 'üíª',
                '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ': '‚úàÔ∏è',
                '–∞–≤—Ç–æ–º–æ–±–∏–ª—å': 'üöó',
                '–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å': 'üè†',
                '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': 'üìö',
                '–µ–¥–∞': 'üçé',
                '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç': 'üöó',
                '–∂–∏–ª—å–µ': 'üè†',
                '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': 'üéÆ',
                '–∑–¥–æ—Ä–æ–≤—å–µ': 'üè•',
                '–∑–∞—Ä–ø–ª–∞—Ç–∞': 'üíº'
            };
            return icons[category] || 'üì¶';
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º user_id –≤ —Ñ–æ—Ä–º–∞—Ö
            if (currentUser) {
                document.getElementById('user_id').value = currentUser.user_id;
                document.getElementById('goalUserId').value = currentUser.user_id;
                document.getElementById('investmentUserId').value = currentUser.user_id;
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã
            if (modalId === 'transactionModal') {
                document.getElementById('transactionForm').reset();
            } else if (modalId === 'goalModal') {
                document.getElementById('goalForm').reset();
                document.getElementById('goalDeadline').valueAsDate = new Date(new Date().setMonth(new Date().getMonth() + 6));
            } else if (modalId === 'investmentModal') {
                document.getElementById('investmentForm').reset();
                document.getElementById('investmentBuyDate').valueAsDate = new Date();
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const colors = {
                'success': '#4caf50',
                'error': '#f44336',
                'warning': '#ff9800',
                'info': '#2196f3'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showLoading() {
            const container = document.querySelector('.app-container');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
            `;
        }

        function hideLoading() {
            // –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        }

        async function loadReferralLink() {
            try {
                const response = await fetch(`${API_URL}/api/get_referral_link?user_id=${currentUser.user_id}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('referralLink').textContent = data.referral_link;
                }
            } catch (error) {
                document.getElementById('referralLink').textContent = 'https://t.me/FinancialLead_bot?start=ref_' + currentUser.user_id;
            }
        }

        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            });
        }

        async function exportData(format) {
            try {
                const url = `${API_URL}/api/export_data?user_id=${currentUser.user_id}&format=${format}`;
                
                if (format === 'csv') {
                    // –î–ª—è CSV —Å–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
                    const response = await fetch(url);
                    const blob = await response.blob();
                    const downloadUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = `finance_data_${currentUser.user_id}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(downloadUrl);
                    
                    showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV', 'success');
                } else {
                    // –î–ª—è JSON –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                    window.open(url, '_blank');
                    showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON', 'success');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
                console.error(error);
            }
        }

        function createReport() {
            showNotification('–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function filterTransactions(type) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            showNotification(`–ü–æ–∫–∞–∑–∞–Ω—ã ${type === 'all' ? '–≤—Å–µ' : type === 'income' ? '–¥–æ—Ö–æ–¥—ã' : '—Ä–∞—Å—Ö–æ–¥—ã'}`, 'info');
        }

        function filterByCategory(category) {
            if (category === 'all') return;
            showNotification(`–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${category}`, 'info');
        }

        function renderExpenseChart() {
            const expenses = {
                '–µ–¥–∞': 20,
                '–∂–∏–ª—å–µ': 25,
                '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç': 15,
                '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': 10,
                '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': 15,
                '–∑–¥–æ—Ä–æ–≤—å–µ': 15
            };
            
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];
            let colorIndex = 0;
            
            const legendContainer = document.getElementById('expenseLegend');
            legendContainer.innerHTML = '';
            
            for (const [category, percent] of Object.entries(expenses)) {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background: ${colors[colorIndex]}"></div>
                    <span>${category} - ${percent}%</span>
                `;
                legendContainer.appendChild(legendItem);
                colorIndex = (colorIndex + 1) % colors.length;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã —Å –ø–æ–º–æ—â—å—é CSS
            const chartContainer = document.getElementById('expenseChart');
            chartContainer.innerHTML = `
                <div style="display: flex; height: 100%; align-items: flex-end; gap: 5px;">
                    ${Object.entries(expenses).map(([category, percent], index) => `
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <div style="width: 80%; background: ${colors[index]}; 
                                  height: ${percent * 1.5}px; border-radius: 4px 4px 0 0;"></div>
                            <div style="font-size: 10px; margin-top: 5px; text-align: center;">${category}</div>
                            <div style="font-size: 12px; font-weight: bold;">${percent}%</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É Telegram
            const theme = Telegram.WebApp.colorScheme;
            if (theme === 'dark') {
                document.body.style.background = '#1a1a1a';
                document.body.style.color = '#ffffff';
                document.querySelector('.app-container').style.background = '#1a1a1a';
                document.querySelectorAll('.card').forEach(card => {
                    card.style.background = '#2a2a2a';
                    card.style.borderColor = '#3a3a3a';
                });
            }
        }
    </script>
</body>
</html>