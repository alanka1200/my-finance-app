<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¢—Ä–µ–∫–µ—Ä | Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #40a7e3;
            --income-color: #4CAF50;
            --expense-color: #f44336;
            --goal-color: #FF9800;
            --investment-color: #9C27B0;
            --savings-color: #00BCD4;
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --card-bg: var(--tg-theme-secondary-bg-color, #f8f9fa);
            --border-color: var(--tg-theme-hint-color, #e0e0e0);
            --button-color: var(--tg-theme-button-color, #40a7e3);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            padding: 16px;
            max-width: 100%;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .header h1 {
            font-size: 22px;
            color: var(--primary-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, var(--primary-color), #2481cc);
            color: white;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .balance-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
        }
        
        .balance-amount {
            font-size: 42px;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-card.income { border-top: 4px solid var(--income-color); }
        .stat-card.expense { border-top: 4px solid var(--expense-color); }
        .stat-card.savings { border-top: 4px solid var(--savings-color); }
        .stat-card.investments { border-top: 4px solid var(--investment-color); }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .stat-card.income .stat-value { color: var(--income-color); }
        .stat-card.expense .stat-value { color: var(--expense-color); }
        .stat-card.savings .stat-value { color: var(--savings-color); }
        .stat-card.investments .stat-value { color: var(--investment-color); }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: var(--card-bg);
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
            border: 2px solid transparent;
        }
        
        .action-btn:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }
        
        .action-btn i {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .action-btn.income i { color: var(--income-color); }
        .action-btn.expense i { color: var(--expense-color); }
        .action-btn.goal i { color: var(--goal-color); }
        .action-btn.investment i { color: var(--investment-color); }
        
        .section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        
        .section-title i {
            color: var(--primary-color);
        }
        
        .see-all {
            font-size: 14px;
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .chart-container {
            height: 250px;
            margin: 15px 0;
            position: relative;
        }
        
        .chart-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .chart-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
        }
        
        .chart-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-color);
            border-radius: 12px;
            margin-bottom: 8px;
            border-left: 5px solid;
            border-right: 1px solid var(--border-color);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .transaction-income { 
            border-left-color: var(--income-color);
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1) 0%, transparent 100%);
        }
        .transaction-expense { 
            border-left-color: var(--expense-color);
            background: linear-gradient(90deg, rgba(244, 67, 54, 0.1) 0%, transparent 100%);
        }
        
        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .transaction-income .transaction-icon {
            background: rgba(76, 175, 80, 0.15);
            color: var(--income-color);
        }
        
        .transaction-expense .transaction-icon {
            background: rgba(244, 67, 54, 0.15);
            color: var(--expense-color);
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-category {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .transaction-description {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #666);
            margin-bottom: 3px;
        }
        
        .transaction-date {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
        }
        
        .transaction-amount {
            font-weight: bold;
            font-size: 16px;
            text-align: right;
        }
        
        .transaction-income .transaction-amount {
            color: var(--income-color);
        }
        
        .transaction-expense .transaction-amount {
            color: var(--expense-color);
        }
        
        .goal-item {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .goal-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--goal-color);
        }
        
        .goal-progress {
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--goal-color), #FFB74D);
            border-radius: 5px;
            transition: width 1s ease;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #666);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: var(--bg-color);
            margin: 5% auto;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .category-btn {
            padding: 12px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .category-btn:hover {
            transform: scale(1.05);
        }
        
        .category-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .category-btn.income { border-left: 4px solid var(--income-color); }
        .category-btn.expense { border-left: 4px solid var(--expense-color); }
        
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: var(--bg-color);
            z-index: 100;
            padding-top: 10px;
        }
        
        .nav-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: var(--tg-theme-hint-color, #666);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .nav-tab i {
            display: block;
            margin-bottom: 5px;
            font-size: 20px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loader {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--tg-theme-hint-color, #666);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .financial-health {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
        }
        
        .health-score {
            font-size: 36px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }
        
        .health-score.excellent { color: #4CAF50; }
        .health-score.good { color: #FF9800; }
        .health-score.poor { color: #f44336; }
        
        .health-info {
            flex: 1;
        }
        
        .health-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .health-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }
        
        .health-fill.excellent { background: #4CAF50; }
        .health-fill.good { background: #FF9800; }
        .health-fill.poor { background: #f44336; }
        
        .advice-item {
            padding: 15px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #FFD700;
            position: relative;
            overflow: hidden;
        }
        
        .advice-item::before {
            content: 'üí°';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            opacity: 0.3;
        }
        
        .advice-item.high {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(229, 57, 53, 0.1));
            border-left-color: #f44336;
        }
        
        .advice-item.high::before {
            content: '‚ö†Ô∏è';
        }
        
        .advice-item.medium {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), rgba(245, 124, 0, 0.1));
            border-left-color: #FF9800;
        }
        
        .investment-card {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--investment-color);
        }
        
        .investment-performance {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .performance-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .performance-badge.positive {
            background: rgba(76, 175, 80, 0.15);
            color: var(--income-color);
        }
        
        .performance-badge.negative {
            background: rgba(244, 67, 54, 0.15);
            color: var(--expense-color);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px 0;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: var(--button-color);
            color: var(--button-text-color);
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-income {
            background: linear-gradient(135deg, var(--income-color), #45a049);
            color: white;
        }
        
        .btn-expense {
            background: linear-gradient(135deg, var(--expense-color), #d32f2f);
            color: white;
        }
        
        .btn-goal {
            background: linear-gradient(135deg, var(--goal-color), #F57C00);
            color: white;
        }
        
        .btn-investment {
            background: linear-gradient(135deg, var(--investment-color), #7B1FA2);
            color: white;
        }
        
        .hidden { display: none !important; }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        @media (max-width: 480px) {
            .container { padding: 0 10px; }
            .category-grid { grid-template-columns: repeat(2, 1fr); }
            .balance-amount { font-size: 36px; }
            .quick-actions { grid-template-columns: repeat(4, 1fr); }
            .action-btn span { display: none; }
            .action-btn i { font-size: 20px; margin-bottom: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-line pulse"></i> –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¢—Ä–µ–∫–µ—Ä</h1>
            <div id="currentDate">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('dashboard')">
                <i class="fas fa-home"></i>
                <span>–î–∞—à–±–æ—Ä–¥</span>
            </div>
            <div class="nav-tab" onclick="switchTab('transactions')">
                <i class="fas fa-exchange-alt"></i>
                <span>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</span>
                <div id="transactionsBadge" class="notification-badge hidden">0</div>
            </div>
            <div class="nav-tab" onclick="switchTab('goals')">
                <i class="fas fa-bullseye"></i>
                <span>–¶–µ–ª–∏</span>
                <div id="goalsBadge" class="notification-badge hidden">0</div>
            </div>
            <div class="nav-tab" onclick="switchTab('investments')">
                <i class="fas fa-chart-line"></i>
                <span>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</span>
            </div>
            <div class="nav-tab" onclick="switchTab('profile')">
                <i class="fas fa-user"></i>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </div>
        </div>
        
        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboardTab" class="tab-content active">
            <div class="balance-card">
                <div>–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balanceAmount">0 ‚ÇΩ</div>
                <div id="balanceChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
                <div style="font-size: 14px; opacity: 0.9;" id="lastUpdate">–û–±–Ω–æ–≤–ª–µ–Ω–æ: --:--</div>
            </div>
            
            <div class="financial-health" id="financialHealth">
                <div class="health-score" id="healthScore">0</div>
                <div class="health-info">
                    <div>–§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="health-bar">
                        <div class="health-fill" id="healthFill" style="width: 0%"></div>
                    </div>
                    <div style="font-size: 12px; margin-top: 5px;" id="healthStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card income" onclick="showDetailedReport('income')">
                    <div><i class="fas fa-arrow-up"></i> –î–æ—Ö–æ–¥—ã</div>
                    <div class="stat-value" id="incomeValue">0 ‚ÇΩ</div>
                    <div style="font-size: 12px;" id="incomeCount">0 –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
                <div class="stat-card expense" onclick="showDetailedReport('expense')">
                    <div><i class="fas fa-arrow-down"></i> –†–∞—Å—Ö–æ–¥—ã</div>
                    <div class="stat-value" id="expenseValue">0 ‚ÇΩ</div>
                    <div style="font-size: 12px;" id="expenseCount">0 –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
                <div class="stat-card savings" onclick="switchTab('goals')">
                    <div><i class="fas fa-piggy-bank"></i> –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</div>
                    <div class="stat-value" id="savingsValue">0%</div>
                    <div style="font-size: 12px;">–æ—Ç –¥–æ—Ö–æ–¥–æ–≤</div>
                </div>
                <div class="stat-card investments" onclick="switchTab('investments')">
                    <div><i class="fas fa-chart-line"></i> –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
                    <div class="stat-value" id="investmentValue">0 ‚ÇΩ</div>
                    <div style="font-size: 12px;" id="investmentCount">0 –∞–∫—Ç–∏–≤–æ–≤</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="action-btn income" onclick="showTransactionModal('income')">
                    <i class="fas fa-plus-circle"></i>
                    <span>–î–æ—Ö–æ–¥</span>
                </button>
                <button class="action-btn expense" onclick="showTransactionModal('expense')">
                    <i class="fas fa-minus-circle"></i>
                    <span>–†–∞—Å—Ö–æ–¥</span>
                </button>
                <button class="action-btn goal" onclick="showGoalModal()">
                    <i class="fas fa-bullseye"></i>
                    <span>–¶–µ–ª—å</span>
                </button>
                <button class="action-btn investment" onclick="showInvestmentModal()">
                    <i class="fas fa-chart-line"></i>
                    <span>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</span>
                </button>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-chart-pie"></i> –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤</span>
                    <span class="see-all" onclick="showDetailedReport('expense')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</span>
                </div>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-lightbulb"></i> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã</span>
                    <span class="see-all" onclick="loadMoreAdvice()">–ï—â–µ ‚Üí</span>
                </div>
                <div id="adviceContainer">
                    <div class="empty-state">
                        <i class="fas fa-lightbulb"></i>
                        <div>–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≤–µ—Ç–æ–≤</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</span>
                    <span class="see-all" onclick="switchTab('transactions')">–í—Å–µ ‚Üí</span>
                </div>
                <div id="recentTransactions">
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <div>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
        <div id="transactionsTab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã</span>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select class="form-input" id="transactionTypeFilter" onchange="filterTransactions()">
                        <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="income">–î–æ—Ö–æ–¥—ã</option>
                        <option value="expense">–†–∞—Å—Ö–æ–¥—ã</option>
                    </select>
                    <select class="form-input" id="transactionPeriodFilter" onchange="filterTransactions()">
                        <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                        <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                        <option value="year">–ó–∞ –≥–æ–¥</option>
                        <option value="all">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</option>
                    </select>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</span>
                    <span class="see-all" onclick="showTransactionModal('income')">–î–æ–±–∞–≤–∏—Ç—å</span>
                </div>
                <div id="transactionsList">
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <div>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –¶–µ–ª–∏ -->
        <div id="goalsTab" class="tab-content">
            <button class="btn btn-goal" onclick="showGoalModal()">
                <i class="fas fa-plus"></i> –ù–æ–≤–∞—è —Ü–µ–ª—å
            </button>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-bullseye"></i> –ê–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏</span>
                </div>
                <div id="goalsList">
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏</span>
                </div>
                <div id="completedGoalsList">
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <div>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö —Ü–µ–ª–µ–π</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ -->
        <div id="investmentsTab" class="tab-content">
            <button class="btn btn-investment" onclick="showInvestmentModal()">
                <i class="fas fa-plus"></i> –ù–æ–≤–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è
            </button>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-chart-line"></i> –ü–æ—Ä—Ç—Ñ–µ–ª—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</span>
                </div>
                <div id="investmentsList">
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-lightbulb"></i> –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –∏–¥–µ–∏</span>
                </div>
                <div id="investmentIdeas">
                    <div class="investment-card">
                        <div style="font-weight: 600; margin-bottom: 5px;">–ê–∫—Ü–∏–∏ –õ–£–ö–û–ô–õ</div>
                        <div style="font-size: 14px; margin-bottom: 10px;">–í—ã—Å–æ–∫–∏–µ –¥–∏–≤–∏–¥–µ–Ω–¥—ã, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç</div>
                        <div class="investment-performance">
                            <div style="font-size: 12px; color: #666;">–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: ~15% –≥–æ–¥–æ–≤—ã—Ö</div>
                        </div>
                    </div>
                    <div class="investment-card">
                        <div style="font-weight: 600; margin-bottom: 5px;">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ TON</div>
                        <div style="font-size: 14px; margin-bottom: 10px;">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram, –≤—ã—Å–æ–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª</div>
                        <div class="investment-performance">
                            <div style="font-size: 12px; color: #666;">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profileTab" class="tab-content">
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-user"></i> –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</span>
                </div>
                <div id="profileInfo">
                    <div class="empty-state">
                        <i class="fas fa-user"></i>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn" onclick="exportData()">
                        <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <button class="btn" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                    </button>
                    <button class="btn btn-primary" onclick="inviteFriend()">
                        <i class="fas fa-user-plus"></i> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</h2>
            
            <div class="form-group">
                <label class="form-label">–°—É–º–º–∞ (‚ÇΩ)</label>
                <input type="number" id="amountInput" class="form-input" placeholder="1000" min="1" step="0.01">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <div class="category-grid" id="categoriesContainer"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <input type="text" id="descriptionInput" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å">
            </div>
            
            <div class="form-group">
                <label class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input type="text" id="tagsInput" class="form-input" placeholder="—Ä–∞–±–æ—Ç–∞, –∞–≤–∞–Ω—Å, —è–Ω–≤–∞—Ä—å">
            </div>
            
            <button class="btn btn-primary" onclick="submitTransaction()">
                <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button class="btn" onclick="closeModal()" style="margin-top: 10px;">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
    
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-bullseye"></i> –ù–æ–≤–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å</h2>
            
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                <input type="text" id="goalTitle" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–æ–≤–∞—è –º–∞—à–∏–Ω–∞">
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—É–º–º–∞ —Ü–µ–ª–∏ (‚ÇΩ)</label>
                <input type="number" id="goalAmount" class="form-input" placeholder="500000" min="1" step="0.01">
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—Ä–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</label>
                <input type="date" id="goalDeadline" class="form-input">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="goalCategory" class="form-input">
                    <option value="–Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è">–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è</option>
                    <option value="–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
                    <option value="–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</option>
                    <option value="–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option value="–∂–∏–ª—å–µ">–ñ–∏–ª—å–µ</option>
                    <option value="—Ç–µ—Ö–Ω–∏–∫–∞">–¢–µ—Ö–Ω–∏–∫–∞</option>
                    <option value="–∞–≤—Ç–æ–º–æ–±–∏–ª—å">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</option>
                    <option value="–∑–¥–æ—Ä–æ–≤—å–µ">–ó–¥–æ—Ä–æ–≤—å–µ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                <select id="goalPriority" class="form-input">
                    <option value="1">–í—ã—Å–æ–∫–∏–π</option>
                    <option value="2">–°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="3">–ù–∏–∑–∫–∏–π</option>
                </select>
            </div>
            
            <button class="btn btn-goal" onclick="submitGoal()">
                <i class="fas fa-check"></i> –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å
            </button>
            <button class="btn" onclick="closeModal()" style="margin-top: 10px;">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
    
    <div id="investmentModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-chart-line"></i> –ù–æ–≤–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è</h2>
            
            <div class="form-group">
                <label class="form-label">–¢–∏–ø –∞–∫—Ç–∏–≤–∞</label>
                <select id="investmentType" class="form-input">
                    <option value="stock">–ê–∫—Ü–∏–∏</option>
                    <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                    <option value="bond">–û–±–ª–∏–≥–∞—Ü–∏–∏</option>
                    <option value="real_estate">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞</label>
                <input type="text" id="investmentName" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –õ–£–ö–û–ô–õ –∏–ª–∏ Bitcoin">
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ (‚ÇΩ)</label>
                <input type="number" id="investmentAmount" class="form-input" placeholder="50000" min="1" step="0.01">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="number" id="investmentQuantity" class="form-input" placeholder="1" min="0.000001" step="0.000001">
            </div>
            
            <button class="btn btn-investment" onclick="submitInvestment()">
                <i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é
            </button>
            <button class="btn" onclick="closeModal()" style="margin-top: 10px;">
                <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
            </button>
        </div>
    </div>
    
    <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
    <div id="loader" class="loader hidden"></div>
    
    <script>
        // Telegram Web App
        let tg = window.Telegram.WebApp;
        let userId = null;
        let currentTransactionType = 'income';
        let selectedCategory = '';
        let charts = {};
        let dashboardData = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.ready();
        tg.setHeaderColor('secondary_bg_color');
        tg.setBackgroundColor('secondary_bg_color');
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        const initData = tg.initDataUnsafe;
        if (initData.user) {
            userId = initData.user.id;
            document.title = `–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¢—Ä–µ–∫–µ—Ä | ${initData.user.first_name}`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º user_id –≤ localStorage –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            localStorage.setItem('telegram_user_id', userId);
        } else {
            // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤–Ω–µ Telegram
            const urlParams = new URLSearchParams(window.location.search);
            userId = urlParams.get('user_id') || localStorage.getItem('telegram_user_id') || 'test_user_123';
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
        const now = new Date();
        const options = { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        };
        document.getElementById('currentDate').textContent = 
            now.toLocaleDateString('ru-RU', options);
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∞–º–∏
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.classList.add('active');
                
                // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.querySelector('span')?.textContent === getTabTitle(tabName)) {
                        tab.classList.add('active');
                    }
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
                loadTabData(tabName);
            }
        }
        
        function getTabTitle(tabName) {
            const titles = {
                'dashboard': '–î–∞—à–±–æ—Ä–¥',
                'transactions': '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏',
                'goals': '–¶–µ–ª–∏',
                'investments': '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏',
                'profile': '–ü—Ä–æ—Ñ–∏–ª—å'
            };
            return titles[tabName];
        }
        
        function loadTabData(tabName) {
            switch(tabName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'goals':
                    loadGoals();
                    break;
                case 'investments':
                    loadInvestments();
                    break;
                case 'profile':
                    loadProfile();
                    break;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            showLoader();
            
            try {
                const data = await getDashboardData();
                dashboardData = data;
                updateDashboard(data);
                updateFinancialHealth(data.analysis);
                updateRecentTransactions(data.summary?.top_transactions || []);
                updateAdvice(data.advice || []);
                hideLoader();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                hideLoader();
            }
        }
        
        async function getDashboardData() {
            return new Promise((resolve, reject) => {
                const requestData = {
                    action: 'get_dashboard_data',
                    user_id: userId
                };
                
                tg.sendData(JSON.stringify(requestData));
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                setTimeout(() => {
                    resolve(getMockDashboardData());
                }, 500);
            });
        }
        
        function getMockDashboardData() {
            return {
                summary: {
                    total_income: 120000,
                    total_expenses: 95000,
                    total_investments: 25000,
                    net_income: 25000,
                    savings_rate: 20.8,
                    total_transactions: 15
                },
                income_structure: [
                    { category: '–∑–∞—Ä–ø–ª–∞—Ç–∞', amount: 100000, percentage: 83.3 },
                    { category: '–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞', amount: 15000, percentage: 12.5 },
                    { category: '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', amount: 5000, percentage: 4.2 }
                ],
                expense_structure: [
                    { category: '–µ–¥–∞', amount: 25000, percentage: 26.3 },
                    { category: '–∂–∏–ª—å–µ', amount: 30000, percentage: 31.6 },
                    { category: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', amount: 15000, percentage: 15.8 },
                    { category: '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', amount: 10000, percentage: 10.5 },
                    { category: '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', amount: 8000, percentage: 8.4 },
                    { category: '–∑–¥–æ—Ä–æ–≤—å–µ', amount: 7000, percentage: 7.4 }
                ],
                goals: [
                    {
                        id: 1,
                        title: '–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫',
                        target_amount: 100000,
                        current_amount: 25000,
                        deadline: '2024-06-30',
                        category: '—Ç–µ—Ö–Ω–∏–∫–∞',
                        progress_percentage: 25,
                        days_remaining: 90,
                        daily_required: 833.33
                    },
                    {
                        id: 2,
                        title: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –¢—É—Ä—Ü–∏—é',
                        target_amount: 150000,
                        current_amount: 50000,
                        deadline: '2024-08-15',
                        category: '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
                        progress_percentage: 33.3,
                        days_remaining: 135,
                        daily_required: 740.74
                    }
                ],
                advice: [
                    { advice_text: 'üí∞ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–∞ 20%', priority: 2 },
                    { advice_text: 'üí° –û—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ 20% –æ—Ç –¥–æ—Ö–æ–¥–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü', priority: 1 },
                    { advice_text: 'üìà –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∞–∫—Ü–∏–∏ –õ–£–ö–û–ô–õ', priority: 3 }
                ],
                analysis: {
                    financial_stability_score: 75,
                    savings_rate: 20.8,
                    expense_to_income_ratio: 79.2,
                    largest_expense_category: '–∂–∏–ª—å–µ',
                    average_daily_spending: 3166.67,
                    recommendations: [
                        {
                            type: 'expenses',
                            title: '–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ "–∂–∏–ª—å–µ"',
                            description: '–ù–∞ —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ö–æ–¥–∏—Ç 31.6% —Ä–∞—Å—Ö–æ–¥–æ–≤.',
                            action: '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç—Ä–∞—Ç—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
                            priority: 'medium'
                        }
                    ]
                },
                balance: 25000,
                currency: '‚ÇΩ',
                timestamp: new Date().toISOString()
            };
        }
        
        function updateDashboard(data) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            document.getElementById('balanceAmount').textContent = 
                `${data.balance.toLocaleString()} ${data.currency}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã
            document.getElementById('incomeValue').textContent = 
                `${data.summary.total_income.toLocaleString()} ${data.currency}`;
            document.getElementById('expenseValue').textContent = 
                `${data.summary.total_expenses.toLocaleString()} ${data.currency}`;
            document.getElementById('savingsValue').textContent = 
                `${data.summary.savings_rate.toFixed(1)}%`;
            document.getElementById('investmentValue').textContent = 
                `${data.summary.total_investments.toLocaleString()} ${data.currency}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            document.getElementById('incomeCount').textContent = 
                `${Math.round(data.summary.total_income / 10000)} –æ–ø–µ—Ä–∞—Ü–∏–π`;
            document.getElementById('expenseCount').textContent = 
                `${Math.round(data.summary.total_expenses / 5000)} –æ–ø–µ—Ä–∞—Ü–∏–π`;
            document.getElementById('investmentCount').textContent = 
                `${Math.round(data.summary.total_investments / 10000)} –∞–∫—Ç–∏–≤–æ–≤`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            const balanceChange = data.summary.net_income;
            const changeElement = document.getElementById('balanceChange');
            changeElement.textContent = 
                `${balanceChange >= 0 ? '+' : ''}${balanceChange.toLocaleString()} ${data.currency} –∑–∞ –º–µ—Å—è—Ü`;
            changeElement.style.color = balanceChange >= 0 ? '#4CAF50' : '#f44336';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.getElementById('lastUpdate').textContent = 
                `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤
            updateExpenseChart(data.expense_structure);
        }
        
        function updateFinancialHealth(analysis) {
            if (!analysis) return;
            
            const score = analysis.financial_stability_score || 0;
            const scoreElement = document.getElementById('healthScore');
            const fillElement = document.getElementById('healthFill');
            const statusElement = document.getElementById('healthStatus');
            
            scoreElement.textContent = score;
            fillElement.style.width = `${score}%`;
            
            let statusText = '';
            let healthClass = '';
            
            if (score >= 80) {
                statusText = '–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ';
                healthClass = 'excellent';
            } else if (score >= 60) {
                statusText = '–•–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ';
                healthClass = 'good';
            } else {
                statusText = '–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è';
                healthClass = 'poor';
            }
            
            scoreElement.className = `health-score ${healthClass}`;
            fillElement.className = `health-fill ${healthClass}`;
            statusElement.textContent = statusText;
        }
        
        function updateRecentTransactions(transactions) {
            const container = document.getElementById('recentTransactions');
            
            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <div>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            transactions.slice(0, 5).forEach(transaction => {
                const isIncome = transaction.type === 'income';
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
                
                html += `
                    <div class="transaction-item transaction-${transaction.type}">
                        <div class="transaction-icon">
                            <i class="fas fa-${isIncome ? 'arrow-up' : 'arrow-down'}"></i>
                        </div>
                        <div class="transaction-info">
                            <div class="transaction-category">${transaction.category}</div>
                            <div class="transaction-description">${transaction.description || ''}</div>
                            <div class="transaction-date">${formattedDate}</div>
                        </div>
                        <div class="transaction-amount">
                            ${isIncome ? '+' : '-'}${transaction.amount.toLocaleString()} ‚ÇΩ
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateAdvice(adviceList) {
            const container = document.getElementById('adviceContainer');
            
            if (!adviceList || adviceList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-lightbulb"></i>
                        <div>–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≤–µ—Ç–æ–≤</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            adviceList.forEach(advice => {
                const priorityClass = advice.priority === 1 ? 'high' : advice.priority === 2 ? 'medium' : '';
                
                html += `
                    <div class="advice-item ${priorityClass}">
                        ${advice.advice_text}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateExpenseChart(expenseStructure) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            if (charts.expenseChart) {
                charts.expenseChart.destroy();
            }
            
            const labels = expenseStructure.map(item => item.category);
            const data = expenseStructure.map(item => item.amount);
            const percentages = expenseStructure.map(item => item.percentage);
            
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#C9CBCF', '#77DD77',
                '#FF6961', '#84B6F4'
            ];
            
            charts.expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: 'var(--bg-color)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'var(--text-color)',
                                font: { size: 12 },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = percentages[context.dataIndex] || 0;
                                    return `${label}: ${value.toLocaleString()} ‚ÇΩ (${percentage}%)`;
                                }
                            }
                        },
                        datalabels: {
                            color: 'var(--text-color)',
                            font: { size: 11, weight: 'bold' },
                            formatter: (value, ctx) => {
                                return percentages[ctx.dataIndex]?.toFixed(1) + '%';
                            }
                        }
                    },
                    cutout: '60%'
                },
                plugins: [ChartDataLabels]
            });
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        function showTransactionModal(type) {
            currentTransactionType = type;
            const modal = document.getElementById('transactionModal');
            const title = document.getElementById('modalTitle');
            
            title.textContent = type === 'income' ? '–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥' : '–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥';
            loadCategories(type);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('amountInput').value = '';
            document.getElementById('descriptionInput').value = '';
            document.getElementById('tagsInput').value = '';
            
            modal.style.display = 'block';
        }
        
        function showGoalModal() {
            const modal = document.getElementById('goalModal');
            const dateInput = document.getElementById('goalDeadline');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É (–∑–∞–≤—Ç—Ä–∞)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.min = tomorrow.toISOString().split('T')[0];
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const inThreeMonths = new Date();
            inThreeMonths.setMonth(inThreeMonths.getMonth() + 3);
            dateInput.value = inThreeMonths.toISOString().split('T')[0];
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('goalTitle').value = '';
            document.getElementById('goalAmount').value = '';
            document.getElementById('goalCategory').value = '–Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è';
            document.getElementById('goalPriority').value = '1';
            
            modal.style.display = 'block';
        }
        
        function showInvestmentModal() {
            const modal = document.getElementById('investmentModal');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('investmentType').value = 'stock';
            document.getElementById('investmentName').value = '';
            document.getElementById('investmentAmount').value = '';
            document.getElementById('investmentQuantity').value = '';
            
            modal.style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('transactionModal').style.display = 'none';
            document.getElementById('goalModal').style.display = 'none';
            document.getElementById('investmentModal').style.display = 'none';
            selectedCategory = '';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function loadCategories(type) {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';
            selectedCategory = '';
            
            const categories = type === 'income' 
                ? [
                    { name: '–∑–∞—Ä–ø–ª–∞—Ç–∞', icon: 'üí∞' },
                    { name: '–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞', icon: 'üíº' },
                    { name: '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', icon: 'üìà' },
                    { name: '–ø–æ–¥–∞—Ä–∫–∏', icon: 'üéÅ' },
                    { name: '–¥–∏–≤–∏–¥–µ–Ω–¥—ã', icon: 'üíπ' },
                    { name: '–∞—Ä–µ–Ω–¥–∞', icon: 'üè†' }
                ]
                : [
                    { name: '–µ–¥–∞', icon: 'üçî' },
                    { name: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', icon: 'üöó' },
                    { name: '–∂–∏–ª—å–µ', icon: 'üè†' },
                    { name: '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', icon: 'üéÆ' },
                    { name: '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', icon: 'üìö' },
                    { name: '–∑–¥–æ—Ä–æ–≤—å–µ', icon: 'üè•' },
                    { name: '–æ–¥–µ–∂–¥–∞', icon: 'üëï' },
                    { name: '—Ç–µ—Ö–Ω–∏–∫–∞', icon: 'üíª' },
                    { name: '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', icon: '‚úàÔ∏è' }
                ];
            
            categories.forEach(cat => {
                const button = document.createElement('div');
                button.className = `category-btn ${type}`;
                button.innerHTML = `${cat.icon} ${cat.name}`;
                button.onclick = () => {
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    selectedCategory = cat.name;
                };
                container.appendChild(button);
            });
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        async function submitTransaction() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            const description = document.getElementById('descriptionInput').value;
            const tags = document.getElementById('tagsInput').value;
            
            if (!amount || amount <= 0) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }
            
            if (!selectedCategory) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                return;
            }
            
            showLoader();
            
            const transactionData = {
                action: 'add_transaction',
                user_id: userId,
                amount: amount,
                category: selectedCategory,
                type: currentTransactionType,
                description: description,
                tags: tags
            };
            
            try {
                tg.sendData(JSON.stringify(transactionData));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    loadDashboardData();
                    closeModal();
                    hideLoader();
                    showSuccess('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
                hideLoader();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–∏
        async function submitGoal() {
            const title = document.getElementById('goalTitle').value.trim();
            const amount = parseFloat(document.getElementById('goalAmount').value);
            const deadline = document.getElementById('goalDeadline').value;
            const category = document.getElementById('goalCategory').value;
            const priority = document.getElementById('goalPriority').value;
            
            if (!title) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏');
                return;
            }
            
            if (!amount || amount <= 0) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }
            
            showLoader();
            
            const goalData = {
                action: 'add_goal',
                user_id: userId,
                title: title,
                target_amount: amount,
                deadline: deadline,
                category: category,
                priority: parseInt(priority)
            };
            
            try {
                tg.sendData(JSON.stringify(goalData));
                
                setTimeout(() => {
                    loadGoals();
                    closeModal();
                    hideLoader();
                    showSuccess('–¶–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ü–µ–ª–∏');
                hideLoader();
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
        async function submitInvestment() {
            const assetType = document.getElementById('investmentType').value;
            const assetName = document.getElementById('investmentName').value.trim();
            const amount = parseFloat(document.getElementById('investmentAmount').value);
            const quantity = parseFloat(document.getElementById('investmentQuantity').value) || 1;
            
            if (!assetName) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞');
                return;
            }
            
            if (!amount || amount <= 0) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }
            
            showLoader();
            
            const investmentData = {
                action: 'add_investment',
                user_id: userId,
                asset_type: assetType,
                asset_name: assetName,
                amount: amount,
                quantity: quantity
            };
            
            try {
                tg.sendData(JSON.stringify(investmentData));
                
                setTimeout(() => {
                    loadInvestments();
                    closeModal();
                    hideLoader();
                    showSuccess('–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏');
                hideLoader();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        async function loadTransactions() {
            showLoader();
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
            setTimeout(() => {
                const mockTransactions = [
                    { id: 1, type: 'income', amount: 120000, category: '–∑–∞—Ä–ø–ª–∞—Ç–∞', description: '–ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å', date: '2024-01-31T10:00:00', tags: '—Ä–∞–±–æ—Ç–∞' },
                    { id: 2, type: 'expense', amount: 25000, category: '–µ–¥–∞', description: '–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ –Ω–µ–¥–µ–ª—é', date: '2024-02-01T18:30:00', tags: '–ø—Ä–æ–¥—É–∫—Ç—ã' },
                    { id: 3, type: 'expense', amount: 5000, category: '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', description: '–ë–µ–Ω–∑–∏–Ω', date: '2024-02-02T08:15:00', tags: '–∞–≤—Ç–æ' },
                    { id: 4, type: 'income', amount: 15000, category: '–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞', description: '–§—Ä–∏–ª–∞–Ω—Å –ø—Ä–æ–µ–∫—Ç', date: '2024-02-03T14:20:00', tags: '—Ñ—Ä–∏–ª–∞–Ω—Å' },
                    { id: 5, type: 'expense', amount: 10000, category: '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', description: '–ö–∏–Ω–æ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω', date: '2024-02-04T20:45:00', tags: '–æ—Ç–¥—ã—Ö' },
                    { id: 6, type: 'expense', amount: 30000, category: '–∂–∏–ª—å–µ', description: '–ò–ø–æ—Ç–µ—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂', date: '2024-02-05T09:00:00', tags: '–∏–ø–æ—Ç–µ–∫–∞' },
                    { id: 7, type: 'income', amount: 5000, category: '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', description: '–î–∏–≤–∏–¥–µ–Ω–¥—ã –ø–æ –∞–∫—Ü–∏—è–º', date: '2024-02-06T12:00:00', tags: '–¥–∏–≤–∏–¥–µ–Ω–¥—ã' }
                ];
                
                updateTransactionsList(mockTransactions);
                hideLoader();
            }, 500);
        }
        
        function filterTransactions() {
            const typeFilter = document.getElementById('transactionTypeFilter').value;
            const periodFilter = document.getElementById('transactionPeriodFilter').value;
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            console.log('–§–∏–ª—å—Ç—Ä—ã:', { type: typeFilter, period: periodFilter });
        }
        
        function updateTransactionsList(transactions) {
            const container = document.getElementById('transactionsList');
            
            if (!transactions || transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <div>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            transactions.forEach(transaction => {
                const isIncome = transaction.type === 'income';
                const date = new Date(transaction.date);
                const formattedDate = date.toLocaleDateString('ru-RU', { 
                    day: '2-digit', 
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const tags = transaction.tags ? 
                    transaction.tags.split(',').map(tag => `<span style="background: var(--border-color); padding: 2px 6px; border-radius: 10px; font-size: 11px; margin-right: 5px;">${tag.trim()}</span>`).join('') : '';
                
                html += `
                    <div class="transaction-item transaction-${transaction.type}">
                        <div class="transaction-icon">
                            <i class="fas fa-${isIncome ? 'arrow-up' : 'arrow-down'}"></i>
                        </div>
                        <div class="transaction-info">
                            <div class="transaction-category">${transaction.category}</div>
                            <div class="transaction-description">${transaction.description || ''}</div>
                            <div style="margin-top: 5px;">${tags}</div>
                            <div class="transaction-date">${formattedDate}</div>
                        </div>
                        <div class="transaction-amount">
                            ${isIncome ? '+' : '-'}${transaction.amount.toLocaleString()} ‚ÇΩ
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–ª–µ–π
        async function loadGoals() {
            showLoader();
            
            setTimeout(() => {
                const mockGoals = [
                    {
                        id: 1,
                        title: '–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫',
                        target_amount: 100000,
                        current_amount: 25000,
                        deadline: '2024-06-30',
                        category: '—Ç–µ—Ö–Ω–∏–∫–∞',
                        progress_percentage: 25,
                        days_remaining: 90,
                        daily_required: 833.33,
                        completed: false
                    },
                    {
                        id: 2,
                        title: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –¢—É—Ä—Ü–∏—é',
                        target_amount: 150000,
                        current_amount: 50000,
                        deadline: '2024-08-15',
                        category: '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ',
                        progress_percentage: 33.3,
                        days_remaining: 135,
                        daily_required: 740.74,
                        completed: false
                    },
                    {
                        id: 3,
                        title: '–ö—É—Ä—Å—ã –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ',
                        target_amount: 30000,
                        current_amount: 30000,
                        deadline: '2024-03-01',
                        category: '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                        progress_percentage: 100,
                        days_remaining: 0,
                        daily_required: 0,
                        completed: true,
                        completed_at: '2024-02-28'
                    }
                ];
                
                updateGoalsList(mockGoals.filter(g => !g.completed));
                updateCompletedGoalsList(mockGoals.filter(g => g.completed));
                hideLoader();
            }, 500);
        }
        
        function updateGoalsList(goals) {
            const container = document.getElementById('goalsList');
            
            if (!goals || goals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bullseye"></i>
                        <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            goals.forEach(goal => {
                const progressBar = createProgressBar(goal.progress_percentage);
                const daysLeft = goal.days_remaining > 0 ? 
                    `<span style="color: #666; font-size: 14px;">‚è∞ ${goal.days_remaining} –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å</span>` : 
                    '<span style="color: #f44336; font-size: 14px;">‚ö†Ô∏è –°—Ä–æ–∫ –∏—Å—Ç–µ–∫</span>';
                
                html += `
                    <div class="goal-item">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: 600; font-size: 16px;">${goal.title}</div>
                                <div style="font-size: 14px; color: #666; margin-top: 2px;">
                                    <i class="fas fa-tag"></i> ${goal.category}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 600; font-size: 18px;">${goal.current_amount.toLocaleString()} ‚ÇΩ</div>
                                <div style="font-size: 14px; color: #666;">–∏–∑ ${goal.target_amount.toLocaleString()} ‚ÇΩ</div>
                            </div>
                        </div>
                        
                        <div class="goal-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${goal.progress_percentage}%"></div>
                            </div>
                            <div class="progress-info">
                                <span>${goal.progress_percentage.toFixed(1)}%</span>
                                <span>${daysLeft}</span>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <div style="font-size: 14px; color: #666;">
                                <i class="fas fa-calendar"></i> –°—Ä–æ–∫: ${goal.deadline}
                            </div>
                            <div style="font-size: 14px; color: #666;">
                                <i class="fas fa-coins"></i> –ï–∂–µ–¥–Ω–µ–≤–Ω–æ: ${goal.daily_required.toFixed(2)} ‚ÇΩ
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateCompletedGoalsList(goals) {
            const container = document.getElementById('completedGoalsList');
            
            if (!goals || goals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <div>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã—Ö —Ü–µ–ª–µ–π</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            goals.forEach(goal => {
                html += `
                    <div class="goal-item" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), transparent);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: 600; font-size: 16px;">${goal.title} <span style="color: #4CAF50;">‚úì</span></div>
                                <div style="font-size: 14px; color: #666; margin-top: 2px;">
                                    <i class="fas fa-tag"></i> ${goal.category}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 600; font-size: 18px; color: #4CAF50;">${goal.target_amount.toLocaleString()} ‚ÇΩ</div>
                                <div style="font-size: 14px; color: #666;">–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ!</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px; color: #666;">
                            <div>
                                <i class="fas fa-calendar"></i> ${goal.deadline}
                            </div>
                            <div>
                                <i class="fas fa-trophy"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ: ${goal.completed_at}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function createProgressBar(percentage) {
            const filled = Math.round(percentage / 5);
            const empty = 20 - filled;
            return '‚ñà'.repeat(filled) + '‚ñë'.repeat(empty);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
        async function loadInvestments() {
            showLoader();
            
            setTimeout(() => {
                const mockInvestments = [
                    {
                        id: 1,
                        asset_type: 'stock',
                        asset_name: '–õ–£–ö–û–ô–õ',
                        amount_invested: 50000,
                        current_value: 55000,
                        purchase_date: '2024-01-15',
                        quantity: 10,
                        profit_loss: 5000,
                        roi_percentage: 10
                    },
                    {
                        id: 2,
                        asset_type: 'crypto',
                        asset_name: 'Bitcoin',
                        amount_invested: 20000,
                        current_value: 25000,
                        purchase_date: '2024-02-01',
                        quantity: 0.0005,
                        profit_loss: 5000,
                        roi_percentage: 25
                    },
                    {
                        id: 3,
                        asset_type: 'stock',
                        asset_name: '–°–±–µ—Ä–±–∞–Ω–∫',
                        amount_invested: 30000,
                        current_value: 32000,
                        purchase_date: '2024-01-20',
                        quantity: 15,
                        profit_loss: 2000,
                        roi_percentage: 6.7
                    }
                ];
                
                updateInvestmentsList(mockInvestments);
                hideLoader();
            }, 500);
        }
        
        function updateInvestmentsList(investments) {
            const container = document.getElementById('investmentsList');
            
            if (!investments || investments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
                    </div>
                `;
                return;
            }
            
            let totalInvested = 0;
            let totalCurrent = 0;
            
            let html = '';
            investments.forEach(inv => {
                const profitLoss = inv.profit_loss || 0;
                const roi = inv.roi_percentage || 0;
                const isPositive = profitLoss >= 0;
                
                totalInvested += inv.amount_invested;
                totalCurrent += inv.current_value || inv.amount_invested;
                
                html += `
                    <div class="investment-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <div style="font-weight: 600; font-size: 16px;">${inv.asset_name}</div>
                                <div style="font-size: 14px; color: #666; margin-top: 2px;">
                                    <i class="fas fa-${getInvestmentIcon(inv.asset_type)}"></i> ${getInvestmentTypeName(inv.asset_type)}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 600; font-size: 18px;">${inv.current_value.toLocaleString()} ‚ÇΩ</div>
                                <div style="font-size: 14px; color: #666;">${inv.quantity} —à—Ç.</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <div style="font-size: 14px; color: #666;">
                                –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${inv.amount_invested.toLocaleString()} ‚ÇΩ
                            </div>
                            <div class="performance-badge ${isPositive ? 'positive' : 'negative'}">
                                ${isPositive ? 'üìà' : 'üìâ'} ${profitLoss >= 0 ? '+' : ''}${profitLoss.toLocaleString()} ‚ÇΩ (${roi.toFixed(1)}%)
                            </div>
                        </div>
                        
                        <div style="font-size: 14px; color: #666; margin-top: 5px;">
                            <i class="fas fa-calendar"></i> –ö—É–ø–ª–µ–Ω–æ: ${inv.purchase_date}
                        </div>
                    </div>
                `;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const totalProfit = totalCurrent - totalInvested;
            const totalRoi = totalInvested > 0 ? (totalProfit / totalInvested * 100) : 0;
            
            html += `
                <div style="background: var(--card-bg); padding: 15px; border-radius: 12px; margin-top: 15px; border: 1px solid var(--border-color);">
                    <div style="font-weight: 600; margin-bottom: 10px; text-align: center;">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; text-align: center;">
                        <div>
                            <div style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                            <div style="font-weight: 600; font-size: 16px;">${totalInvested.toLocaleString()} ‚ÇΩ</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #666;">–¢–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                            <div style="font-weight: 600; font-size: 16px;">${totalCurrent.toLocaleString()} ‚ÇΩ</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #666;">–ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫</div>
                            <div style="font-weight: 600; font-size: 16px; color: ${totalProfit >= 0 ? '#4CAF50' : '#f44336'}">
                                ${totalProfit >= 0 ? '+' : ''}${totalProfit.toLocaleString()} ‚ÇΩ
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #666;">–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (ROI)</div>
                            <div style="font-weight: 600; font-size: 16px; color: ${totalRoi >= 0 ? '#4CAF50' : '#f44336'}">
                                ${totalRoi >= 0 ? '+' : ''}${totalRoi.toFixed(1)}%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function getInvestmentIcon(type) {
            const icons = {
                'stock': 'chart-line',
                'crypto': 'bitcoin',
                'bond': 'hand-holding-usd',
                'real_estate': 'home',
                'other': 'coins'
            };
            return icons[type] || 'coins';
        }
        
        function getInvestmentTypeName(type) {
            const names = {
                'stock': '–ê–∫—Ü–∏–∏',
                'crypto': '–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞',
                'bond': '–û–±–ª–∏–≥–∞—Ü–∏–∏',
                'real_estate': '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å',
                'other': '–î—Ä—É–≥–æ–µ'
            };
            return names[type] || '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
        async function loadProfile() {
            showLoader();
            
            setTimeout(() => {
                const mockProfile = {
                    full_name: '–ò–≤–∞–Ω –î–º–∏—Ç—Ä–∏–µ–Ω–∫–æ',
                    profession: 'IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
                    main_income: 120000,
                    balance: 25000,
                    registration_date: '2024-01-15',
                    financial_goal: '–ù–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É',
                    monthly_savings_goal: 50000,
                    investment_percentage: 15
                };
                
                updateProfileInfo(mockProfile);
                hideLoader();
            }, 500);
        }
        
        function updateProfileInfo(profile) {
            const container = document.getElementById('profileInfo');
            
            if (!profile) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user"></i>
                        <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</div>
                    </div>
                `;
                return;
            }
            
            const html = `
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), #2481cc); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold;">
                        ${profile.full_name ? profile.full_name.charAt(0).toUpperCase() : '?'}
                    </div>
                    <div>
                        <div style="font-weight: 600; font-size: 18px;">${profile.full_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                        <div style="font-size: 14px; color: #666;">${profile.profession || '–ü—Ä–æ—Ñ–µ—Å—Å–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: var(--bg-color); padding: 12px; border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="font-size: 12px; color: #666;">–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ—Ö–æ–¥</div>
                        <div style="font-weight: 600; font-size: 16px;">${profile.main_income ? profile.main_income.toLocaleString() + ' ‚ÇΩ' : '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                    </div>
                    <div style="background: var(--bg-color); padding: 12px; border-radius: 10px; border: 1px solid var(--border-color);">
                        <div style="font-size: 12px; color: #666;">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                        <div style="font-weight: 600; font-size: 16px;">${profile.balance ? profile.balance.toLocaleString() + ' ‚ÇΩ' : '0 ‚ÇΩ'}</div>
                    </div>
                </div>
                
                ${profile.financial_goal ? `
                    <div style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1), transparent); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--goal-color);">
                        <div style="font-weight: 600; margin-bottom: 5px;">üéØ –ì–ª–∞–≤–Ω–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å</div>
                        <div>${profile.financial_goal}</div>
                    </div>
                ` : ''}
                
                <div style="background: var(--bg-color); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color);">
                    <div style="font-weight: 600; margin-bottom: 10px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>–¶–µ–ª—å –ø–æ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è–º:</span>
                        <span style="font-weight: 600;">${profile.monthly_savings_goal ? profile.monthly_savings_goal.toLocaleString() + ' ‚ÇΩ/–º–µ—Å' : '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>–î–æ–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π:</span>
                        <span style="font-weight: 600;">${profile.investment_percentage ? profile.investment_percentage + '%' : '0%'}</span>
                    </div>
                </div>
                
                <div style="font-size: 14px; color: #666; text-align: center; margin-top: 15px;">
                    <i class="fas fa-calendar"></i> –£—á–∞—Å—Ç–Ω–∏–∫ —Å ${profile.registration_date || '--.--.----'}
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
        }
        
        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }
        
        function showError(message) {
            tg.showAlert(message);
        }
        
        function showSuccess(message) {
            tg.showAlert(message);
        }
        
        function showDetailedReport(type) {
            tg.showAlert(`–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ ${type === 'income' ? '–¥–æ—Ö–æ–¥–∞–º' : '—Ä–∞—Å—Ö–æ–¥–∞–º'} –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏`);
        }
        
        function loadMoreAdvice() {
            tg.showAlert('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤...');
        }
        
        function exportData() {
            tg.showAlert('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }
        
        function generateReport() {
            tg.showAlert('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –æ—Ç—á–µ—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }
        
        function inviteFriend() {
            tg.showAlert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            const modals = ['transactionModal', 'goalModal', 'investmentModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            showLoader();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            await loadDashboardData();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã Telegram
            updateTheme();
            
            tg.onEvent('themeChanged', updateTheme);
            tg.onEvent('viewportChanged', () => {
                tg.expand();
            });
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadDashboardData, 30000);
            
            hideLoader();
        });
        
        function updateTheme() {
            document.documentElement.style.setProperty('--bg-color', tg.themeParams.bg_color || '#ffffff');
            document.documentElement.style.setProperty('--text-color', tg.themeParams.text_color || '#000000');
            document.documentElement.style.setProperty('--card-bg', tg.themeParams.secondary_bg_color || '#f8f9fa');
            document.documentElement.style.setProperty('--border-color', tg.themeParams.hint_color || '#e0e0e0');
            document.documentElement.style.setProperty('--button-color', tg.themeParams.button_color || '#40a7e3');
            document.documentElement.style.setProperty('--button-text-color', tg.themeParams.button_text_color || '#ffffff');
        }
    </script>
</body>
</html>