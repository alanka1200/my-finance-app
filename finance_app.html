<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ | Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #2481cc;
            --tg-theme-button-color: #40a7e3;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f1f1f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            line-height: 1.6;
            padding: 16px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--tg-theme-secondary-bg-color);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color);
        }
        
        .welcome-text {
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }
        
        .section {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #40a7e3, #2481cc);
            color: white;
            text-align: center;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            margin: 8px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }
        
        .stat-item {
            background: var(--tg-theme-bg-color);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            margin: 4px 0;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }
        
        .income {
            color: #4CAF50;
        }
        
        .expense {
            color: #f44336;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px 0;
            text-align: center;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-income {
            background: #4CAF50;
        }
        
        .btn-expense {
            background: #f44336;
        }
        
        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--tg-theme-button-color);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .category-btn {
            padding: 10px;
            background: var(--tg-theme-secondary-bg-color);
            border: 2px solid transparent;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .category-btn.active {
            border-color: var(--tg-theme-button-color);
            background: var(--tg-theme-button-color);
            color: white;
        }
        
        .chart-container {
            height: 200px;
            margin: 20px 0;
        }
        
        .transaction-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--tg-theme-bg-color);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .transaction-amount.income {
            color: #4CAF50;
            font-weight: 600;
        }
        
        .transaction-amount.expense {
            color: #f44336;
            font-weight: 600;
        }
        
        .advice-card {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 16px;
            border-radius: 12px;
            margin: 8px 0;
        }
        
        .advice-text {
            font-style: italic;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--tg-theme-button-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 8px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="userName">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫</h1>
            <p class="welcome-text" id="currentDate">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div id="mainPanel">
            <div class="balance-card">
                <div>–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balanceAmount">0 ‚ÇΩ</div>
                <div id="balanceChange">+0 ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">–î–æ—Ö–æ–¥—ã</div>
                    <div class="stat-value income" id="incomeValue">0 ‚ÇΩ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã</div>
                    <div class="stat-value expense" id="expenseValue">0 ‚ÇΩ</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="chart-container">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>
            
            <button class="btn btn-income" onclick="showAddTransaction('income')">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥
            </button>
            <button class="btn btn-expense" onclick="showAddTransaction('expense')">
                ‚ûñ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
            </button>
            
            <div class="section">
                <div class="section-title">üí° –°–æ–≤–µ—Ç—ã</div>
                <div id="adviceContainer">
                    <div class="advice-card">
                        <div class="advice-text">–ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-secondary" onclick="refreshData()">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
        <div id="transactionForm" class="hidden">
            <div class="section">
                <div class="section-title" id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</div>
                
                <div class="form-group">
                    <label class="form-label">–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" id="amountInput" class="form-input" placeholder="1000" min="1" step="0.01">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <div class="category-grid" id="categoriesContainer">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="descriptionInput" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞—Ä–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å">
                </div>
                
                <button class="btn btn-income" id="submitBtn" onclick="submitTransaction()">
                    ‚úÖ –î–æ–±–∞–≤–∏—Ç—å
                </button>
                <button class="btn btn-secondary" onclick="showMainPanel()">
                    ‚Ü©Ô∏è –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>
        
        <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
        <div id="loader" class="loader hidden"></div>
    </div>

    <script>
        // Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let tg = window.Telegram.WebApp;
        let userId = null;
        let currentTransactionType = 'income';
        let selectedCategory = '';
        let chart = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        tg.expand();
        tg.ready();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        const initData = tg.initDataUnsafe;
        if (initData.user) {
            userId = initData.user.id;
            document.getElementById('userName').textContent = 
                `–ü—Ä–∏–≤–µ—Ç, ${initData.user.first_name || '–î—Ä—É–≥'}!`;
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
        const now = new Date();
        document.getElementById('currentDate').textContent = 
            now.toLocaleDateString('ru-RU', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        
        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–∞–Ω–µ–ª–µ–π
        function showMainPanel() {
            document.getElementById('mainPanel').classList.remove('hidden');
            document.getElementById('transactionForm').classList.add('hidden');
        }
        
        function showAddTransaction(type) {
            currentTransactionType = type;
            document.getElementById('formTitle').textContent = 
                type === 'income' ? '–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥' : '–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥';
            document.getElementById('submitBtn').className = 
                type === 'income' ? 'btn btn-income' : 'btn btn-expense';
            document.getElementById('submitBtn').textContent = 
                type === 'income' ? '‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥' : '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            loadCategories(type);
            
            document.getElementById('mainPanel').classList.add('hidden');
            document.getElementById('transactionForm').classList.remove('hidden');
        }
        
        function loadCategories(type) {
            const categoriesContainer = document.getElementById('categoriesContainer');
            categoriesContainer.innerHTML = '';
            selectedCategory = '';
            
            const categories = type === 'income' 
                ? ['–∑–∞—Ä–ø–ª–∞—Ç–∞', '–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–ø–æ–¥–∞—Ä–∫–∏', '–¥—Ä—É–≥–æ–µ']
                : ['–µ–¥–∞', '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', '–∂–∏–ª—å–µ', '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', '–∑–¥–æ—Ä–æ–≤—å–µ', '–¥—Ä—É–≥–æ–µ'];
            
            categories.forEach(category => {
                const button = document.createElement('div');
                button.className = 'category-btn';
                button.textContent = category;
                button.onclick = () => {
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∫–Ω–æ–ø–∫—É
                    button.classList.add('active');
                    selectedCategory = category;
                };
                categoriesContainer.appendChild(button);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        async function submitTransaction() {
            const amount = parseFloat(document.getElementById('amountInput').value);
            const description = document.getElementById('descriptionInput').value;
            
            if (!amount || amount <= 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
                return;
            }
            
            if (!selectedCategory) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                return;
            }
            
            showLoader();
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            const transactionData = {
                action: 'add_transaction',
                user_id: userId,
                amount: amount,
                category: selectedCategory,
                type: currentTransactionType,
                description: description
            };
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç —á–µ—Ä–µ–∑ Telegram Web App
                tg.sendData(JSON.stringify(transactionData));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                setTimeout(() => {
                    refreshData();
                    showMainPanel();
                    resetForm();
                    hideLoader();
                    tg.showAlert('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
                hideLoader();
            }
        }
        
        function resetForm() {
            document.getElementById('amountInput').value = '';
            document.getElementById('descriptionInput').value = '';
            selectedCategory = '';
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function refreshData() {
            showLoader();
            
            try {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                await loadMockData();
                updateUI();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            } finally {
                hideLoader();
            }
        }
        
        // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ
        async function loadMockData() {
            return new Promise(resolve => {
                setTimeout(() => {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ
                    const mockData = {
                        summary: {
                            income: Math.floor(Math.random() * 100000) + 50000,
                            expense: Math.floor(Math.random() * 80000) + 30000,
                            balance: Math.floor(Math.random() * 50000) + 10000,
                            expense_structure: {
                                '–µ–¥–∞': 25,
                                '—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç': 15,
                                '–∂–∏–ª—å–µ': 30,
                                '—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': 20,
                                '–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ': 10
                            }
                        },
                        advice: [
                            'üí∞ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
                            'üí° –û—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ 20% –æ—Ç –¥–æ—Ö–æ–¥–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü',
                            'üìà –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è'
                        ]
                    };
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    window.financeData = mockData;
                    resolve();
                }, 500);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            const data = window.financeData;
            if (!data) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            document.getElementById('balanceAmount').textContent = 
                `${data.summary.balance.toLocaleString()} ‚ÇΩ`;
            
            document.getElementById('incomeValue').textContent = 
                `${data.summary.income.toLocaleString()} ‚ÇΩ`;
            
            document.getElementById('expenseValue').textContent = 
                `${data.summary.expense.toLocaleString()} ‚ÇΩ`;
            
            const balanceChange = data.summary.income - data.summary.expense;
            document.getElementById('balanceChange').textContent = 
                `${balanceChange >= 0 ? '+' : ''}${balanceChange.toLocaleString()} ‚ÇΩ –∑–∞ –º–µ—Å—è—Ü`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫
            updateChart(data.summary.expense_structure);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–≤–µ—Ç—ã
            updateAdvice(data.advice);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart(expenseStructure) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
            if (chart) {
                chart.destroy();
            }
            
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#C9CBCF'
            ];
            
            const labels = Object.keys(expenseStructure);
            const data = Object.values(expenseStructure);
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: tg.themeParams.bg_color || '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: tg.themeParams.text_color || '#000000',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–≤–µ—Ç–æ–≤
        function updateAdvice(adviceList) {
            const container = document.getElementById('adviceContainer');
            container.innerHTML = '';
            
            adviceList.forEach(advice => {
                const card = document.createElement('div');
                card.className = 'advice-card';
                card.innerHTML = `
                    <div class="advice-text">${advice}</div>
                `;
                container.appendChild(card);
            });
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º
        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
        }
        
        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            showLoader();
            await refreshData();
            hideLoader();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã Telegram
            document.body.style.backgroundColor = tg.backgroundColor;
            document.body.style.color = tg.textColor;
            
            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ–º—ã
            tg.onEvent('themeChanged', () => {
                document.body.style.backgroundColor = tg.backgroundColor;
                document.body.style.color = tg.textColor;
            });
        });
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ø–∞–Ω–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        showMainPanel();
    </script>
</body>
</html>